{% extends "parent.html" %}
{% block title %}Issues{% endblock %}
{% block content %}
<style>
.disabled{
	color:black;
	background-color:#0000;
	border: 2px solid #0000;
	opacity:1;
}
input,select{
	max-width:160px;
	width:160px;
}
select.disabled {
	-webkit-appearance: none;
	-moz-appearance: none;
	text-indent: 1px;
	text-overflow: '';
}
select.disabled::-ms-expand {
	display: none;
}
</style>
<table class="pure-table">
	<thead style = "border-right-style: hidden">
		<tr>
			<th>Number</th>
			<th>Issue</th>
			<th>Priority</th>
			<th>Opened On</th>
			<th>Opened By</th>
			<th>Assignee</th>
			<th>Closed On</th>
			<th>Closed By</th>
			<th>Status</th>
			<th class = "button-header"> </th>
		</tr>
	</thead>
	<tbody>
	{% set prio = ["Low","Medium","High","Urgent"] %}
	{% set status = ["Open","Closed","In Progress"] %}
	{% for r in results %}
		<tr>
			<td> {{r.id}} </td>
			<td> <input class = "disabled" type = "text" value = "{{r.issue}}" disabled /> </td>
			<td> <select class = "disabled" disabled>
			{% for p in prio %}
				<option value = "{{p}}" {% if r.priority == p %}selected{% endif %}>{{p}}</option>
			{% endfor %}
			</select></td>
			<td> <input class = "disabled" type = "date" value="{{r.opened_on}}" disabled /> </td>
			<td> <input class = "disabled" type = "text" value = "{{r.opened_by}}" disabled /> </td>
			<td> <input class = "disabled" type = "text" value = "{{r.assignee}}" disabled /> </td>
			<td> <input class = "disabled" type = "date" value="{{r.closed_on}}" disabled /> </td>
			<td> <input class = "disabled" type = "text" value = "{{r.closed_by}}" disabled /> </td>
			<td> <select class = "disabled" disabled>
			{% for s in status %}
				<option value = "{{s}}" {% if r.status == s %}selected{% endif %}>{{s}}</option>
			{% endfor %}
			</select></td>
			<td class = "buttons">
				<button class="edit-button" onclick="editIssue({{r.id}},this.parentElement.parentElement)">
					<i class="fa fa-edit"></i>
				</button>
				<button class="delete-button" onclick="deleteIssue(this);">
					<i class="fa fa-trash"></i>
				</button>
			</td>
		</tr>
	{% endfor %}
	</tbody>
</table>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
function editIssue(id,row) {
	console.log(id)
	console.log(row)
	cells = row.children
	for(i = 1;i<9;i++){
		cells[i].children[0].disabled = false;
		cells[i].children[0].className="";
	}
	cells[9].children[0].innerHTML="<i class=\"fa fa-save\"></i>";
	cells[9].children[0].setAttribute("onClick","saveIssue("+id+",this.parentElement.parentElement)");
}
function saveIssue(id,row){
	console.log("saving")
	console.log(id)
	console.log(row)
	cells = row.children
	for(i = 1;i<9;i++){
		cells[i].children[0].disabled = true;
		cells[i].children[0].className="disabled";
	}
	cells[9].children[0].innerHTML="<i class=\"fa fa-edit\"></i>";
	cells[9].children[0].setAttribute("onClick","editIssue("+id+",this.parentElement.parentElement)");
	$.post("/edit_issue",{
		"id": 		 id,
		"issue": 	 cells[1].children[0].value,
		"priority":	cells[2].children[0].value,
		"opened_on": cells[3].children[0].value,
		"opened_by": cells[4].children[0].value,
		"assignee":	cells[5].children[0].value,
		"closed_on": cells[6].children[0].value,
		"closed_by": cells[7].children[0].value,
		"status": 	 cells[8].children[0].value,
	});
}

function deleteIssue(button) {
	row = button.parentNode.parentNode;
	const data = { issueId: row.cells[0].innerHTML };
	fetch('/delete', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
		},
		body: JSON.stringify(data),
	});
	row.remove();
};
</script>
{%endblock %}
